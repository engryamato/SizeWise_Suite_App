f8544a333de0321f7c95232f810faa6c
"use strict";
/**
 * Integration Test Setup
 *
 * Global setup for HVAC component integration tests
 * Configures mocks, test utilities, and environment for integration testing
 *
 * Part of Phase 1 bridging plan for comprehensive integration test coverage
 *
 * @see docs/post-implementation-bridging-plan.md Task 1.1
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.mockNetworkConditions = exports.setupIntegrationTestEnvironment = exports.createMockCalculationResults = exports.createMockCalculationData = exports.mockApiResponse = void 0;
require('@testing-library/jest-dom');
// =============================================================================
// Global Mocks
// =============================================================================
// Mock fetch globally
global.fetch = jest.fn();
// Mock localStorage
const mockLocalStorage = {
    store: {},
    getItem: jest.fn((key) => mockLocalStorage.store[key] || null),
    setItem: jest.fn((key, value) => {
        mockLocalStorage.store[key] = value;
    }),
    removeItem: jest.fn((key) => {
        delete mockLocalStorage.store[key];
    }),
    clear: jest.fn(() => {
        mockLocalStorage.store = {};
    }),
    length: 0,
    key: jest.fn()
};
Object.defineProperty(window, 'localStorage', {
    value: mockLocalStorage
});
// Mock sessionStorage
Object.defineProperty(window, 'sessionStorage', {
    value: mockLocalStorage
});
// Mock IndexedDB for offline storage testing
const mockIndexedDB = {
    open: jest.fn(() => Promise.resolve({
        result: {
            createObjectStore: jest.fn(),
            transaction: jest.fn(() => ({
                objectStore: jest.fn(() => ({
                    add: jest.fn(() => Promise.resolve()),
                    get: jest.fn(() => Promise.resolve()),
                    put: jest.fn(() => Promise.resolve()),
                    delete: jest.fn(() => Promise.resolve())
                }))
            }))
        }
    })),
    deleteDatabase: jest.fn(() => Promise.resolve())
};
Object.defineProperty(window, 'indexedDB', {
    value: mockIndexedDB
});
// Mock Service Worker
Object.defineProperty(navigator, 'serviceWorker', {
    value: {
        register: jest.fn(() => Promise.resolve({
            installing: null,
            waiting: null,
            active: {
                postMessage: jest.fn()
            },
            addEventListener: jest.fn(),
            removeEventListener: jest.fn()
        })),
        ready: Promise.resolve({
            active: {
                postMessage: jest.fn()
            }
        }),
        controller: {
            postMessage: jest.fn()
        }
    },
    writable: true
});
// Mock Web Workers for WASM calculations
Object.defineProperty(window, 'Worker', {
    value: class MockWorker {
        constructor(url) {
            this.url = url;
            this.postMessage = jest.fn();
            this.terminate = jest.fn();
            this.addEventListener = jest.fn();
            this.removeEventListener = jest.fn();
        }
    }
});
// Mock WebAssembly for WASM testing
Object.defineProperty(window, 'WebAssembly', {
    value: {
        instantiate: jest.fn(() => Promise.resolve({
            instance: {
                exports: {
                    calculate_air_duct_size: jest.fn(() => 14.0),
                    calculate_pressure_drop: jest.fn(() => 0.8),
                    calculate_heat_transfer: jest.fn(() => 1200.0),
                    optimize_hvac_system: jest.fn(() => ({ efficiency: 0.95 }))
                }
            }
        })),
        compile: jest.fn(() => Promise.resolve({}))
    }
});
// =============================================================================
// Test Utilities
// =============================================================================
/**
 * Mock API response helper
 */
const mockApiResponse = (data, options = {}) => {
    const { ok = true, status = 200 } = options;
    return {
        ok,
        status,
        json: async () => data,
        text: async () => JSON.stringify(data),
        headers: new Headers(),
        redirected: false,
        statusText: ok ? 'OK' : 'Error',
        type: 'basic',
        url: '',
        clone: jest.fn(),
        body: null,
        bodyUsed: false,
        arrayBuffer: async () => new ArrayBuffer(0),
        blob: async () => new Blob(),
        formData: async () => new FormData()
    };
};
exports.mockApiResponse = mockApiResponse;
/**
 * Mock HVAC calculation data factory
 */
exports.createMockCalculationData = {
    airDuct: (overrides = {}) => ({
        airflow: 1500,
        duct_type: 'round',
        friction_rate: 0.08,
        units: 'imperial',
        material: 'galvanized_steel',
        ...overrides
    }),
    pressureDrop: (overrides = {}) => ({
        airflow: 2000,
        duct_length: 100,
        duct_diameter: 16,
        fittings: [
            { type: 'elbow_90', quantity: 2 },
            { type: 'tee_branch', quantity: 1 }
        ],
        ...overrides
    }),
    compliance: (overrides = {}) => ({
        system_type: 'supply_air',
        velocity: 1800,
        duct_type: 'rectangular',
        width: 20,
        height: 8,
        standards: ['SMACNA', 'ASHRAE'],
        ...overrides
    })
};
/**
 * Mock calculation results factory
 */
exports.createMockCalculationResults = {
    airDuct: (overrides = {}) => ({
        success: true,
        results: {
            diameter: { value: 14.0, unit: 'in' },
            velocity: { value: 1400.0, unit: 'fpm' },
            area: { value: 1.07, unit: 'sq_ft' },
            pressure_loss: { value: 0.8, unit: 'in_wg_per_100ft' }
        },
        compliance: {
            smacna: {
                velocity: { passed: true, value: 1400.0, limit: 2500 }
            }
        },
        ...overrides
    }),
    compliance: (overrides = {}) => ({
        success: true,
        overall_compliance: 'compliant',
        validation_results: {
            smacna: { status: 'compliant', score: 95 },
            ashrae: { status: 'compliant', score: 88 }
        },
        ...overrides
    })
};
/**
 * Integration test environment setup
 */
const setupIntegrationTestEnvironment = () => {
    // Set test environment variables
    process.env.NODE_ENV = 'test';
    process.env.TESTING = 'true';
    process.env.API_BASE_URL = 'http://127.0.0.1:5000/api';
    // Configure console for test environment
    const originalConsoleError = console.error;
    console.error = (...args) => {
        // Suppress expected React warnings in tests
        if (typeof args[0] === 'string' &&
            args[0].includes('Warning: ReactDOM.render is no longer supported')) {
            return;
        }
        originalConsoleError.call(console, ...args);
    };
    return {
        cleanup: () => {
            console.error = originalConsoleError;
        }
    };
};
exports.setupIntegrationTestEnvironment = setupIntegrationTestEnvironment;
/**
 * Mock network conditions for offline testing
 */
exports.mockNetworkConditions = {
    online: () => {
        Object.defineProperty(navigator, 'onLine', {
            writable: true,
            value: true
        });
    },
    offline: () => {
        Object.defineProperty(navigator, 'onLine', {
            writable: true,
            value: false
        });
    },
    slowConnection: () => {
        // Mock slow network by adding delays to fetch
        const originalFetch = global.fetch;
        global.fetch = jest.fn((...args) => {
            return new Promise(resolve => {
                setTimeout(() => {
                    resolve(originalFetch(...args));
                }, 2000); // 2 second delay
            });
        });
    }
};
// =============================================================================
// Global Test Setup
// =============================================================================
beforeEach(() => {
    // Clear all mocks before each test
    jest.clearAllMocks();
    // Reset localStorage
    mockLocalStorage.clear();
    // Reset fetch mock
    global.fetch.mockClear();
    // Reset network to online
    exports.mockNetworkConditions.online();
});
afterEach(() => {
    // Clean up any timers
    jest.clearAllTimers();
    // Reset modules
    jest.resetModules();
});
// Setup integration test environment
const testEnv = (0, exports.setupIntegrationTestEnvironment)();
// Cleanup after all tests
afterAll(() => {
    testEnv.cleanup();
});
// Custom matcher for HVAC calculation validation
expect.extend({
    toBeValidHVACCalculation(received) {
        const pass = received &&
            received.success === true &&
            received.results &&
            typeof received.results === 'object';
        return {
            message: () => pass
                ? `Expected ${received} not to be a valid HVAC calculation`
                : `Expected ${received} to be a valid HVAC calculation with success=true and results object`,
            pass
        };
    },
    toBeCompliantWithStandards(received, standards) {
        const pass = received &&
            received.compliance &&
            standards.every((standard) => received.compliance[standard.toLowerCase()] &&
                received.compliance[standard.toLowerCase()].status === 'compliant');
        return {
            message: () => pass
                ? `Expected ${received} not to be compliant with standards ${standards.join(', ')}`
                : `Expected ${received} to be compliant with standards ${standards.join(', ')}`,
            pass
        };
    },
    toHaveOfflineCapability(received) {
        const pass = received &&
            (received.calculated_offline === true || received.offline_capable === true);
        return {
            message: () => pass
                ? `Expected ${received} not to have offline capability`
                : `Expected ${received} to have offline capability`,
            pass
        };
    }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2pvaG5yZXlyYXpvbmFibGUvRG9jdW1lbnRzL1NpemVXaXNlX1N1aXRlX0FwcC90ZXN0cy9pbnRlZ3JhdGlvbi9zZXR1cC9pbnRlZ3JhdGlvbi10ZXN0LXNldHVwLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7O0dBU0c7OztBQUVILE9BQU8sQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO0FBRXJDLGdGQUFnRjtBQUNoRixlQUFlO0FBQ2YsZ0ZBQWdGO0FBRWhGLHNCQUFzQjtBQUN0QixNQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUV6QixvQkFBb0I7QUFDcEIsTUFBTSxnQkFBZ0IsR0FBRztJQUN2QixLQUFLLEVBQUUsRUFBNEI7SUFDbkMsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFXLEVBQUUsRUFBRSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUM7SUFDdEUsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFXLEVBQUUsS0FBYSxFQUFFLEVBQUU7UUFDOUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQztJQUN0QyxDQUFDLENBQUM7SUFDRixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQVcsRUFBRSxFQUFFO1FBQ2xDLE9BQU8sZ0JBQWdCLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3JDLENBQUMsQ0FBQztJQUNGLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRTtRQUNsQixnQkFBZ0IsQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO0lBQzlCLENBQUMsQ0FBQztJQUNGLE1BQU0sRUFBRSxDQUFDO0lBQ1QsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDZixDQUFDO0FBRUYsTUFBTSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsY0FB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dUNBQXVDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQ25GLENBQUMsQ0FBQyxZQUFZLFFBQVEsbUNBQW1DLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDakYsSUFBSTtTQUNMLENBQUM7SUFDSixDQUFDO0lBRUQsdUJBQXVCLENBQUMsUUFBUTtRQUM5QixNQUFNLElBQUksR0FBRyxRQUFRO1lBQ25CLENBQUMsUUFBUSxDQUFDLGtCQUFrQixLQUFLLElBQUksSUFBSSxRQUFRLENBQUMsZUFBZSxLQUFLLElBQUksQ0FBQyxDQUFDO1FBRTlFLE9BQU87WUFDTCxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBSTtnQkFDakIsQ0FBQyxDQUFDLFlBQVksUUFBUSxpQ0FBaUM7Z0JBQ3ZELENBQUMsQ0FBQyxZQUFZLFFBQVEsNkJBQTZCO1lBQ3JELElBQUk7U0FDTCxDQUFDO0lBQ0osQ0FBQztDQUNGLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvam9obnJleXJhem9uYWJsZS9Eb2N1bWVudHMvU2l6ZVdpc2VfU3VpdGVfQXBwL3Rlc3RzL2ludGVncmF0aW9uL3NldHVwL2ludGVncmF0aW9uLXRlc3Qtc2V0dXAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBJbnRlZ3JhdGlvbiBUZXN0IFNldHVwXG4gKiBcbiAqIEdsb2JhbCBzZXR1cCBmb3IgSFZBQyBjb21wb25lbnQgaW50ZWdyYXRpb24gdGVzdHNcbiAqIENvbmZpZ3VyZXMgbW9ja3MsIHRlc3QgdXRpbGl0aWVzLCBhbmQgZW52aXJvbm1lbnQgZm9yIGludGVncmF0aW9uIHRlc3RpbmdcbiAqIFxuICogUGFydCBvZiBQaGFzZSAxIGJyaWRnaW5nIHBsYW4gZm9yIGNvbXByZWhlbnNpdmUgaW50ZWdyYXRpb24gdGVzdCBjb3ZlcmFnZVxuICogXG4gKiBAc2VlIGRvY3MvcG9zdC1pbXBsZW1lbnRhdGlvbi1icmlkZ2luZy1wbGFuLm1kIFRhc2sgMS4xXG4gKi9cblxucmVxdWlyZSgnQHRlc3RpbmctbGlicmFyeS9qZXN0LWRvbScpO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gR2xvYmFsIE1vY2tzXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vLyBNb2NrIGZldGNoIGdsb2JhbGx5XG5nbG9iYWwuZmV0Y2ggPSBqZXN0LmZuKCk7XG5cbi8vIE1vY2sgbG9jYWxTdG9yYWdlXG5jb25zdCBtb2NrTG9jYWxTdG9yYWdlID0ge1xuICBzdG9yZToge30gYXMgUmVjb3JkPHN0cmluZywgc3RyaW5nPixcbiAgZ2V0SXRlbTogamVzdC5mbigoa2V5OiBzdHJpbmcpID0+IG1vY2tMb2NhbFN0b3JhZ2Uuc3RvcmVba2V5XSB8fCBudWxsKSxcbiAgc2V0SXRlbTogamVzdC5mbigoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICBtb2NrTG9jYWxTdG9yYWdlLnN0b3JlW2tleV0gPSB2YWx1ZTtcbiAgfSksXG4gIHJlbW92ZUl0ZW06IGplc3QuZm4oKGtleTogc3RyaW5nKSA9PiB7XG4gICAgZGVsZXRlIG1vY2tMb2NhbFN0b3JhZ2Uuc3RvcmVba2V5XTtcbiAgfSksXG4gIGNsZWFyOiBqZXN0LmZuKCgpID0+IHtcbiAgICBtb2NrTG9jYWxTdG9yYWdlLnN0b3JlID0ge307XG4gIH0pLFxuICBsZW5ndGg6IDAsXG4gIGtleTogamVzdC5mbigpXG59O1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnbG9jYWxTdG9yYWdlJywge1xuICB2YWx1ZTogbW9ja0xvY2FsU3RvcmFnZVxufSk7XG5cbi8vIE1vY2sgc2Vzc2lvblN0b3JhZ2Vcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csICdzZXNzaW9uU3RvcmFnZScsIHtcbiAgdmFsdWU6IG1vY2tMb2NhbFN0b3JhZ2Vcbn0pO1xuXG4vLyBNb2NrIEluZGV4ZWREQiBmb3Igb2ZmbGluZSBzdG9yYWdlIHRlc3RpbmdcbmNvbnN0IG1vY2tJbmRleGVkREIgPSB7XG4gIG9wZW46IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICByZXN1bHQ6IHtcbiAgICAgIGNyZWF0ZU9iamVjdFN0b3JlOiBqZXN0LmZuKCksXG4gICAgICB0cmFuc2FjdGlvbjogamVzdC5mbigoKSA9PiAoe1xuICAgICAgICBvYmplY3RTdG9yZTogamVzdC5mbigoKSA9PiAoe1xuICAgICAgICAgIGFkZDogamVzdC5mbigoKSA9PiBQcm9taXNlLnJlc29sdmUoKSksXG4gICAgICAgICAgZ2V0OiBqZXN0LmZuKCgpID0+IFByb21pc2UucmVzb2x2ZSgpKSxcbiAgICAgICAgICBwdXQ6IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCkpLFxuICAgICAgICAgIGRlbGV0ZTogamVzdC5mbigoKSA9PiBQcm9taXNlLnJlc29sdmUoKSlcbiAgICAgICAgfSkpXG4gICAgICB9KSlcbiAgICB9XG4gIH0pKSxcbiAgZGVsZXRlRGF0YWJhc2U6IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCkpXG59O1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnaW5kZXhlZERCJywge1xuICB2YWx1ZTogbW9ja0luZGV4ZWREQlxufSk7XG5cbi8vIE1vY2sgU2VydmljZSBXb3JrZXJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShuYXZpZ2F0b3IsICdzZXJ2aWNlV29ya2VyJywge1xuICB2YWx1ZToge1xuICAgIHJlZ2lzdGVyOiBqZXN0LmZuKCgpID0+IFByb21pc2UucmVzb2x2ZSh7XG4gICAgICBpbnN0YWxsaW5nOiBudWxsLFxuICAgICAgd2FpdGluZzogbnVsbCxcbiAgICAgIGFjdGl2ZToge1xuICAgICAgICBwb3N0TWVzc2FnZTogamVzdC5mbigpXG4gICAgICB9LFxuICAgICAgYWRkRXZlbnRMaXN0ZW5lcjogamVzdC5mbigpLFxuICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcjogamVzdC5mbigpXG4gICAgfSkpLFxuICAgIHJlYWR5OiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgYWN0aXZlOiB7XG4gICAgICAgIHBvc3RNZXNzYWdlOiBqZXN0LmZuKClcbiAgICAgIH1cbiAgICB9KSxcbiAgICBjb250cm9sbGVyOiB7XG4gICAgICBwb3N0TWVzc2FnZTogamVzdC5mbigpXG4gICAgfVxuICB9LFxuICB3cml0YWJsZTogdHJ1ZVxufSk7XG5cbi8vIE1vY2sgV2ViIFdvcmtlcnMgZm9yIFdBU00gY2FsY3VsYXRpb25zXG5PYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnV29ya2VyJywge1xuICB2YWx1ZTogY2xhc3MgTW9ja1dvcmtlciB7XG4gICAgY29uc3RydWN0b3IocHVibGljIHVybDogc3RyaW5nKSB7fVxuICAgIHBvc3RNZXNzYWdlID0gamVzdC5mbigpO1xuICAgIHRlcm1pbmF0ZSA9IGplc3QuZm4oKTtcbiAgICBhZGRFdmVudExpc3RlbmVyID0gamVzdC5mbigpO1xuICAgIHJlbW92ZUV2ZW50TGlzdGVuZXIgPSBqZXN0LmZuKCk7XG4gIH1cbn0pO1xuXG4vLyBNb2NrIFdlYkFzc2VtYmx5IGZvciBXQVNNIHRlc3Rpbmdcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csICdXZWJBc3NlbWJseScsIHtcbiAgdmFsdWU6IHtcbiAgICBpbnN0YW50aWF0ZTogamVzdC5mbigoKSA9PiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgaW5zdGFuY2U6IHtcbiAgICAgICAgZXhwb3J0czoge1xuICAgICAgICAgIGNhbGN1bGF0ZV9haXJfZHVjdF9zaXplOiBqZXN0LmZuKCgpID0+IDE0LjApLFxuICAgICAgICAgIGNhbGN1bGF0ZV9wcmVzc3VyZV9kcm9wOiBqZXN0LmZuKCgpID0+IDAuOCksXG4gICAgICAgICAgY2FsY3VsYXRlX2hlYXRfdHJhbnNmZXI6IGplc3QuZm4oKCkgPT4gMTIwMC4wKSxcbiAgICAgICAgICBvcHRpbWl6ZV9odmFjX3N5c3RlbTogamVzdC5mbigoKSA9PiAoeyBlZmZpY2llbmN5OiAwLjk1IH0pKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSkpLFxuICAgIGNvbXBpbGU6IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHt9KSlcbiAgfVxufSk7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBUZXN0IFV0aWxpdGllc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBNb2NrIEFQSSByZXNwb25zZSBoZWxwZXJcbiAqL1xuZXhwb3J0IGNvbnN0IG1vY2tBcGlSZXNwb25zZSA9IChkYXRhOiBhbnksIG9wdGlvbnM6IHsgb2s/OiBib29sZWFuOyBzdGF0dXM/OiBudW1iZXIgfSA9IHt9KSA9PiB7XG4gIGNvbnN0IHsgb2sgPSB0cnVlLCBzdGF0dXMgPSAyMDAgfSA9IG9wdGlvbnM7XG4gIFxuICByZXR1cm4ge1xuICAgIG9rLFxuICAgIHN0YXR1cyxcbiAgICBqc29uOiBhc3luYyAoKSA9PiBkYXRhLFxuICAgIHRleHQ6IGFzeW5jICgpID0+IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgIGhlYWRlcnM6IG5ldyBIZWFkZXJzKCksXG4gICAgcmVkaXJlY3RlZDogZmFsc2UsXG4gICAgc3RhdHVzVGV4dDogb2sgPyAnT0snIDogJ0Vycm9yJyxcbiAgICB0eXBlOiAnYmFzaWMnIGFzIFJlc3BvbnNlVHlwZSxcbiAgICB1cmw6ICcnLFxuICAgIGNsb25lOiBqZXN0LmZuKCksXG4gICAgYm9keTogbnVsbCxcbiAgICBib2R5VXNlZDogZmFsc2UsXG4gICAgYXJyYXlCdWZmZXI6IGFzeW5jICgpID0+IG5ldyBBcnJheUJ1ZmZlcigwKSxcbiAgICBibG9iOiBhc3luYyAoKSA9PiBuZXcgQmxvYigpLFxuICAgIGZvcm1EYXRhOiBhc3luYyAoKSA9PiBuZXcgRm9ybURhdGEoKVxuICB9IGFzIFJlc3BvbnNlO1xufTtcblxuLyoqXG4gKiBNb2NrIEhWQUMgY2FsY3VsYXRpb24gZGF0YSBmYWN0b3J5XG4gKi9cbmV4cG9ydCBjb25zdCBjcmVhdGVNb2NrQ2FsY3VsYXRpb25EYXRhID0ge1xuICBhaXJEdWN0OiAob3ZlcnJpZGVzOiBQYXJ0aWFsPGFueT4gPSB7fSkgPT4gKHtcbiAgICBhaXJmbG93OiAxNTAwLFxuICAgIGR1Y3RfdHlwZTogJ3JvdW5kJyxcbiAgICBmcmljdGlvbl9yYXRlOiAwLjA4LFxuICAgIHVuaXRzOiAnaW1wZXJpYWwnLFxuICAgIG1hdGVyaWFsOiAnZ2FsdmFuaXplZF9zdGVlbCcsXG4gICAgLi4ub3ZlcnJpZGVzXG4gIH0pLFxuICBcbiAgcHJlc3N1cmVEcm9wOiAob3ZlcnJpZGVzOiBQYXJ0aWFsPGFueT4gPSB7fSkgPT4gKHtcbiAgICBhaXJmbG93OiAyMDAwLFxuICAgIGR1Y3RfbGVuZ3RoOiAxMDAsXG4gICAgZHVjdF9kaWFtZXRlcjogMTYsXG4gICAgZml0dGluZ3M6IFtcbiAgICAgIHsgdHlwZTogJ2VsYm93XzkwJywgcXVhbnRpdHk6IDIgfSxcbiAgICAgIHsgdHlwZTogJ3RlZV9icmFuY2gnLCBxdWFudGl0eTogMSB9XG4gICAgXSxcbiAgICAuLi5vdmVycmlkZXNcbiAgfSksXG4gIFxuICBjb21wbGlhbmNlOiAob3ZlcnJpZGVzOiBQYXJ0aWFsPGFueT4gPSB7fSkgPT4gKHtcbiAgICBzeXN0ZW1fdHlwZTogJ3N1cHBseV9haXInLFxuICAgIHZlbG9jaXR5OiAxODAwLFxuICAgIGR1Y3RfdHlwZTogJ3JlY3Rhbmd1bGFyJyxcbiAgICB3aWR0aDogMjAsXG4gICAgaGVpZ2h0OiA4LFxuICAgIHN0YW5kYXJkczogWydTTUFDTkEnLCAnQVNIUkFFJ10sXG4gICAgLi4ub3ZlcnJpZGVzXG4gIH0pXG59O1xuXG4vKipcbiAqIE1vY2sgY2FsY3VsYXRpb24gcmVzdWx0cyBmYWN0b3J5XG4gKi9cbmV4cG9ydCBjb25zdCBjcmVhdGVNb2NrQ2FsY3VsYXRpb25SZXN1bHRzID0ge1xuICBhaXJEdWN0OiAob3ZlcnJpZGVzOiBQYXJ0aWFsPGFueT4gPSB7fSkgPT4gKHtcbiAgICBzdWNjZXNzOiB0cnVlLFxuICAgIHJlc3VsdHM6IHtcbiAgICAgIGRpYW1ldGVyOiB7IHZhbHVlOiAxNC4wLCB1bml0OiAnaW4nIH0sXG4gICAgICB2ZWxvY2l0eTogeyB2YWx1ZTogMTQwMC4wLCB1bml0OiAnZnBtJyB9LFxuICAgICAgYXJlYTogeyB2YWx1ZTogMS4wNywgdW5pdDogJ3NxX2Z0JyB9LFxuICAgICAgcHJlc3N1cmVfbG9zczogeyB2YWx1ZTogMC44LCB1bml0OiAnaW5fd2dfcGVyXzEwMGZ0JyB9XG4gICAgfSxcbiAgICBjb21wbGlhbmNlOiB7XG4gICAgICBzbWFjbmE6IHtcbiAgICAgICAgdmVsb2NpdHk6IHsgcGFzc2VkOiB0cnVlLCB2YWx1ZTogMTQwMC4wLCBsaW1pdDogMjUwMCB9XG4gICAgICB9XG4gICAgfSxcbiAgICAuLi5vdmVycmlkZXNcbiAgfSksXG4gIFxuICBjb21wbGlhbmNlOiAob3ZlcnJpZGVzOiBQYXJ0aWFsPGFueT4gPSB7fSkgPT4gKHtcbiAgICBzdWNjZXNzOiB0cnVlLFxuICAgIG92ZXJhbGxfY29tcGxpYW5jZTogJ2NvbXBsaWFudCcsXG4gICAgdmFsaWRhdGlvbl9yZXN1bHRzOiB7XG4gICAgICBzbWFjbmE6IHsgc3RhdHVzOiAnY29tcGxpYW50Jywgc2NvcmU6IDk1IH0sXG4gICAgICBhc2hyYWU6IHsgc3RhdHVzOiAnY29tcGxpYW50Jywgc2NvcmU6IDg4IH1cbiAgICB9LFxuICAgIC4uLm92ZXJyaWRlc1xuICB9KVxufTtcblxuLyoqXG4gKiBJbnRlZ3JhdGlvbiB0ZXN0IGVudmlyb25tZW50IHNldHVwXG4gKi9cbmV4cG9ydCBjb25zdCBzZXR1cEludGVncmF0aW9uVGVzdEVudmlyb25tZW50ID0gKCkgPT4ge1xuICAvLyBTZXQgdGVzdCBlbnZpcm9ubWVudCB2YXJpYWJsZXNcbiAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAndGVzdCc7XG4gIHByb2Nlc3MuZW52LlRFU1RJTkcgPSAndHJ1ZSc7XG4gIHByb2Nlc3MuZW52LkFQSV9CQVNFX1VSTCA9ICdodHRwOi8vMTI3LjAuMC4xOjUwMDAvYXBpJztcbiAgXG4gIC8vIENvbmZpZ3VyZSBjb25zb2xlIGZvciB0ZXN0IGVudmlyb25tZW50XG4gIGNvbnN0IG9yaWdpbmFsQ29uc29sZUVycm9yID0gY29uc29sZS5lcnJvcjtcbiAgY29uc29sZS5lcnJvciA9ICguLi5hcmdzOiBhbnlbXSkgPT4ge1xuICAgIC8vIFN1cHByZXNzIGV4cGVjdGVkIFJlYWN0IHdhcm5pbmdzIGluIHRlc3RzXG4gICAgaWYgKFxuICAgICAgdHlwZW9mIGFyZ3NbMF0gPT09ICdzdHJpbmcnICYmXG4gICAgICBhcmdzWzBdLmluY2x1ZGVzKCdXYXJuaW5nOiBSZWFjdERPTS5yZW5kZXIgaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZCcpXG4gICAgKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIG9yaWdpbmFsQ29uc29sZUVycm9yLmNhbGwoY29uc29sZSwgLi4uYXJncyk7XG4gIH07XG4gIFxuICByZXR1cm4ge1xuICAgIGNsZWFudXA6ICgpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IgPSBvcmlnaW5hbENvbnNvbGVFcnJvcjtcbiAgICB9XG4gIH07XG59O1xuXG4vKipcbiAqIE1vY2sgbmV0d29yayBjb25kaXRpb25zIGZvciBvZmZsaW5lIHRlc3RpbmdcbiAqL1xuZXhwb3J0IGNvbnN0IG1vY2tOZXR3b3JrQ29uZGl0aW9ucyA9IHtcbiAgb25saW5lOiAoKSA9PiB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5hdmlnYXRvciwgJ29uTGluZScsIHtcbiAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgdmFsdWU6IHRydWVcbiAgICB9KTtcbiAgfSxcbiAgXG4gIG9mZmxpbmU6ICgpID0+IHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmF2aWdhdG9yLCAnb25MaW5lJywge1xuICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICB2YWx1ZTogZmFsc2VcbiAgICB9KTtcbiAgfSxcbiAgXG4gIHNsb3dDb25uZWN0aW9uOiAoKSA9PiB7XG4gICAgLy8gTW9jayBzbG93IG5ldHdvcmsgYnkgYWRkaW5nIGRlbGF5cyB0byBmZXRjaFxuICAgIGNvbnN0IG9yaWdpbmFsRmV0Y2ggPSBnbG9iYWwuZmV0Y2g7XG4gICAgZ2xvYmFsLmZldGNoID0gamVzdC5mbigoLi4uYXJncykgPT4ge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICByZXNvbHZlKG9yaWdpbmFsRmV0Y2goLi4uYXJncykpO1xuICAgICAgICB9LCAyMDAwKTsgLy8gMiBzZWNvbmQgZGVsYXlcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG59O1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gR2xvYmFsIFRlc3QgU2V0dXBcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmJlZm9yZUVhY2goKCkgPT4ge1xuICAvLyBDbGVhciBhbGwgbW9ja3MgYmVmb3JlIGVhY2ggdGVzdFxuICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgXG4gIC8vIFJlc2V0IGxvY2FsU3RvcmFnZVxuICBtb2NrTG9jYWxTdG9yYWdlLmNsZWFyKCk7XG4gIFxuICAvLyBSZXNldCBmZXRjaCBtb2NrXG4gIChnbG9iYWwuZmV0Y2ggYXMgamVzdC5Nb2NrZWRGdW5jdGlvbjx0eXBlb2YgZmV0Y2g+KS5tb2NrQ2xlYXIoKTtcbiAgXG4gIC8vIFJlc2V0IG5ldHdvcmsgdG8gb25saW5lXG4gIG1vY2tOZXR3b3JrQ29uZGl0aW9ucy5vbmxpbmUoKTtcbn0pO1xuXG5hZnRlckVhY2goKCkgPT4ge1xuICAvLyBDbGVhbiB1cCBhbnkgdGltZXJzXG4gIGplc3QuY2xlYXJBbGxUaW1lcnMoKTtcbiAgXG4gIC8vIFJlc2V0IG1vZHVsZXNcbiAgamVzdC5yZXNldE1vZHVsZXMoKTtcbn0pO1xuXG4vLyBTZXR1cCBpbnRlZ3JhdGlvbiB0ZXN0IGVudmlyb25tZW50XG5jb25zdCB0ZXN0RW52ID0gc2V0dXBJbnRlZ3JhdGlvblRlc3RFbnZpcm9ubWVudCgpO1xuXG4vLyBDbGVhbnVwIGFmdGVyIGFsbCB0ZXN0c1xuYWZ0ZXJBbGwoKCkgPT4ge1xuICB0ZXN0RW52LmNsZWFudXAoKTtcbn0pO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ3VzdG9tIE1hdGNoZXJzXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5kZWNsYXJlIGdsb2JhbCB7XG4gIG5hbWVzcGFjZSBqZXN0IHtcbiAgICBpbnRlcmZhY2UgTWF0Y2hlcnM8Uj4ge1xuICAgICAgdG9CZVZhbGlkSFZBQ0NhbGN1bGF0aW9uKCk6IFI7XG4gICAgICB0b0JlQ29tcGxpYW50V2l0aFN0YW5kYXJkcyhzdGFuZGFyZHM6IHN0cmluZ1tdKTogUjtcbiAgICAgIHRvSGF2ZU9mZmxpbmVDYXBhYmlsaXR5KCk6IFI7XG4gICAgfVxuICB9XG59XG5cbi8vIEN1c3RvbSBtYXRjaGVyIGZvciBIVkFDIGNhbGN1bGF0aW9uIHZhbGlkYXRpb25cbmV4cGVjdC5leHRlbmQoe1xuICB0b0JlVmFsaWRIVkFDQ2FsY3VsYXRpb24ocmVjZWl2ZWQpIHtcbiAgICBjb25zdCBwYXNzID0gcmVjZWl2ZWQgJiZcbiAgICAgIHJlY2VpdmVkLnN1Y2Nlc3MgPT09IHRydWUgJiZcbiAgICAgIHJlY2VpdmVkLnJlc3VsdHMgJiZcbiAgICAgIHR5cGVvZiByZWNlaXZlZC5yZXN1bHRzID09PSAnb2JqZWN0JztcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgbWVzc2FnZTogKCkgPT4gcGFzc1xuICAgICAgICA/IGBFeHBlY3RlZCAke3JlY2VpdmVkfSBub3QgdG8gYmUgYSB2YWxpZCBIVkFDIGNhbGN1bGF0aW9uYFxuICAgICAgICA6IGBFeHBlY3RlZCAke3JlY2VpdmVkfSB0byBiZSBhIHZhbGlkIEhWQUMgY2FsY3VsYXRpb24gd2l0aCBzdWNjZXNzPXRydWUgYW5kIHJlc3VsdHMgb2JqZWN0YCxcbiAgICAgIHBhc3NcbiAgICB9O1xuICB9LFxuICBcbiAgdG9CZUNvbXBsaWFudFdpdGhTdGFuZGFyZHMocmVjZWl2ZWQsIHN0YW5kYXJkcykge1xuICAgIGNvbnN0IHBhc3MgPSByZWNlaXZlZCAmJlxuICAgICAgcmVjZWl2ZWQuY29tcGxpYW5jZSAmJlxuICAgICAgc3RhbmRhcmRzLmV2ZXJ5KChzdGFuZGFyZDogc3RyaW5nKSA9PiBcbiAgICAgICAgcmVjZWl2ZWQuY29tcGxpYW5jZVtzdGFuZGFyZC50b0xvd2VyQ2FzZSgpXSAmJlxuICAgICAgICByZWNlaXZlZC5jb21wbGlhbmNlW3N0YW5kYXJkLnRvTG93ZXJDYXNlKCldLnN0YXR1cyA9PT0gJ2NvbXBsaWFudCdcbiAgICAgICk7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIG1lc3NhZ2U6ICgpID0+IHBhc3NcbiAgICAgICAgPyBgRXhwZWN0ZWQgJHtyZWNlaXZlZH0gbm90IHRvIGJlIGNvbXBsaWFudCB3aXRoIHN0YW5kYXJkcyAke3N0YW5kYXJkcy5qb2luKCcsICcpfWBcbiAgICAgICAgOiBgRXhwZWN0ZWQgJHtyZWNlaXZlZH0gdG8gYmUgY29tcGxpYW50IHdpdGggc3RhbmRhcmRzICR7c3RhbmRhcmRzLmpvaW4oJywgJyl9YCxcbiAgICAgIHBhc3NcbiAgICB9O1xuICB9LFxuICBcbiAgdG9IYXZlT2ZmbGluZUNhcGFiaWxpdHkocmVjZWl2ZWQpIHtcbiAgICBjb25zdCBwYXNzID0gcmVjZWl2ZWQgJiZcbiAgICAgIChyZWNlaXZlZC5jYWxjdWxhdGVkX29mZmxpbmUgPT09IHRydWUgfHwgcmVjZWl2ZWQub2ZmbGluZV9jYXBhYmxlID09PSB0cnVlKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgbWVzc2FnZTogKCkgPT4gcGFzc1xuICAgICAgICA/IGBFeHBlY3RlZCAke3JlY2VpdmVkfSBub3QgdG8gaGF2ZSBvZmZsaW5lIGNhcGFiaWxpdHlgXG4gICAgICAgIDogYEV4cGVjdGVkICR7cmVjZWl2ZWR9IHRvIGhhdmUgb2ZmbGluZSBjYXBhYmlsaXR5YCxcbiAgICAgIHBhc3NcbiAgICB9O1xuICB9XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==