ed9f22a2f22821a50c7c1a06f662bc56
"use strict";
/**
 * SMACNAValidator - Pure Validation Functions for SMACNA Standards
 *
 * MISSION-CRITICAL: Pure TypeScript functions for SMACNA, ASHRAE, and NFPA compliance validation
 * Extracted from UI components for reusability and tier enforcement integration
 *
 * @see docs/implementation/tier-system/tier-boundaries-specification.md
 * @see docs/developer-guide/tier-implementation-checklist.md section 2.4
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.SMACNAValidator = void 0;
/**
 * SMACNAValidator - Pure validation functions for HVAC standards
 * CRITICAL: No dependencies on UI, storage, or external services
 */
class SMACNAValidator {
    /**
     * Validate calculation against SMACNA standards
     * CRITICAL: Pure function with comprehensive validation
     */
    static validateSMACNACompliance(data) {
        const result = {
            isValid: true,
            compliant: true,
            errors: [],
            warnings: [],
            recommendations: [],
            standardReference: 'SMACNA HVAC Duct Construction Standards 2012',
            score: 100
        };
        try {
            // Velocity validation
            this.validateVelocity(data, result);
            // Friction rate validation
            this.validateFrictionRate(data, result);
            // Aspect ratio validation (for rectangular ducts)
            if (data.ductType === 'rectangular' && data.aspectRatio) {
                this.validateAspectRatio(data, result);
            }
            // Area validation
            this.validateArea(data, result);
            // Material and construction validation
            this.validateConstruction(data, result);
            // Calculate overall score
            result.score = this.calculateSMACNAScore(data, result);
        }
        catch (error) {
            result.errors.push(`SMACNA validation error: ${error.message}`);
            result.isValid = false;
            result.compliant = false;
            result.score = 0;
        }
        return result;
    }
    /**
     * Validate calculation against ASHRAE standards
     */
    static validateASHRAECompliance(data) {
        const result = {
            isValid: true,
            compliant: true,
            errors: [],
            warnings: [],
            recommendations: [],
            standardReference: 'ASHRAE Fundamentals 2021 Chapter 21',
            score: 100
        };
        try {
            const { velocity, location = 'unoccupied' } = data;
            const standards = this.ASHRAE_STANDARDS;
            // Comfort velocity validation
            if (location === 'occupied') {
                if (velocity > standards.comfortVelocity.occupiedZone) {
                    result.warnings.push(`Velocity ${velocity} FPM in occupied zone exceeds ASHRAE comfort limit of ${standards.comfortVelocity.occupiedZone} FPM`);
                    result.score -= 20;
                }
            }
            else {
                if (velocity > standards.comfortVelocity.unoccupiedZone) {
                    result.warnings.push(`Velocity ${velocity} FPM exceeds ASHRAE general limit of ${standards.comfortVelocity.unoccupiedZone} FPM`);
                    result.score -= 10;
                }
            }
            // Noise velocity validation
            if (velocity > standards.noiseVelocity.loud) {
                result.warnings.push(`High velocity ${velocity} FPM may cause excessive noise`);
                result.recommendations.push('Consider noise attenuation measures');
                result.score -= 15;
            }
            else if (velocity > standards.noiseVelocity.moderate) {
                result.recommendations.push('Monitor noise levels in occupied spaces');
                result.score -= 5;
            }
        }
        catch (error) {
            result.errors.push(`ASHRAE validation error: ${error.message}`);
            result.isValid = false;
            result.compliant = false;
            result.score = 0;
        }
        return result;
    }
    /**
     * Validate calculation against NFPA 96 standards (for grease ducts)
     */
    static validateNFPACompliance(data) {
        const result = {
            isValid: true,
            compliant: true,
            errors: [],
            warnings: [],
            recommendations: [],
            standardReference: 'NFPA 96 Standard for Ventilation Control and Fire Protection 2021',
            score: 100
        };
        try {
            if (data.application !== 'grease') {
                result.warnings.push('NFPA 96 validation only applies to grease exhaust systems');
                return result;
            }
            const { velocity, pressure = 0 } = data;
            const standards = this.NFPA_STANDARDS;
            // Velocity validation for grease removal
            if (velocity < standards.greaseVelocity.minimum) {
                result.errors.push(`Velocity ${velocity} FPM is below NFPA 96 minimum of ${standards.greaseVelocity.minimum} FPM for grease removal`);
                result.compliant = false;
                result.score -= 50;
            }
            else if (velocity < standards.greaseVelocity.recommended) {
                result.warnings.push(`Velocity ${velocity} FPM is below NFPA 96 recommended minimum of ${standards.greaseVelocity.recommended} FPM`);
                result.score -= 20;
            }
            // Pressure validation
            if (pressure > standards.greasePressure.maximum) {
                result.warnings.push(`Static pressure ${pressure} inches w.g. exceeds NFPA 96 recommended maximum of ${standards.greasePressure.maximum} inches w.g.`);
                result.score -= 15;
            }
            // Additional grease duct requirements
            if (data.ductType !== 'round') {
                result.warnings.push('NFPA 96 recommends round ducts for grease exhaust systems');
                result.recommendations.push('Consider using round duct for easier cleaning and maintenance');
                result.score -= 10;
            }
        }
        catch (error) {
            result.errors.push(`NFPA validation error: ${error.message}`);
            result.isValid = false;
            result.compliant = false;
            result.score = 0;
        }
        return result;
    }
    /**
     * Validate against all applicable standards
     */
    static validateAllStandards(data) {
        const results = {};
        // Always validate SMACNA for general ductwork
        results.smacna = this.validateSMACNACompliance(data);
        // Validate ASHRAE for comfort considerations
        results.ashrae = this.validateASHRAECompliance(data);
        // Validate NFPA if it's a grease duct
        if (data.application === 'grease') {
            results.nfpa = this.validateNFPACompliance(data);
        }
        return results;
    }
    /**
     * Validate velocity against SMACNA standards
     */
    static validateVelocity(data, result) {
        const { velocity, application = 'supply' } = data;
        const limits = this.SMACNA_STANDARDS.velocity[application] || this.SMACNA_STANDARDS.velocity.supply;
        if (velocity < limits.min) {
            result.warnings.push(`Velocity ${velocity} FPM is below SMACNA minimum of ${limits.min} FPM for ${application} duct`);
            result.score -= 15;
        }
        else if (velocity > limits.max) {
            result.errors.push(`Velocity ${velocity} FPM exceeds SMACNA maximum of ${limits.max} FPM for ${application} duct`);
            result.compliant = false;
            result.score -= 30;
        }
        else if (velocity > limits.optimal * 1.2) {
            result.warnings.push(`Velocity ${velocity} FPM is above optimal range (${limits.optimal} FPM Â±20%) for ${application} duct`);
            result.score -= 10;
        }
        else if (velocity < limits.optimal * 0.8) {
            result.recommendations.push(`Consider reducing duct size to achieve optimal velocity of ${limits.optimal} FPM`);
            result.score -= 5;
        }
    }
    /**
     * Validate friction rate against SMACNA standards
     */
    static validateFrictionRate(data, result) {
        const { frictionRate } = data;
        const standards = this.SMACNA_STANDARDS.friction;
        if (frictionRate > standards.maximum) {
            result.errors.push(`Friction rate ${frictionRate.toFixed(3)} inches w.g./100ft exceeds SMACNA maximum of ${standards.maximum} inches w.g./100ft`);
            result.compliant = false;
            result.score -= 25;
        }
        else if (frictionRate > standards.high) {
            result.warnings.push(`High friction rate ${frictionRate.toFixed(3)} inches w.g./100ft may cause excessive pressure loss`);
            result.score -= 15;
        }
        else if (frictionRate < standards.low) {
            result.recommendations.push('Low friction rate indicates oversized duct - consider optimization for cost savings');
            result.score -= 5;
        }
    }
    /**
     * Validate aspect ratio for rectangular ducts
     */
    static validateAspectRatio(data, result) {
        const { aspectRatio } = data;
        if (!aspectRatio)
            return;
        const standards = this.SMACNA_STANDARDS.aspectRatio;
        if (aspectRatio > standards.maximum) {
            result.errors.push(`Aspect ratio ${aspectRatio.toFixed(1)}:1 exceeds SMACNA maximum of ${standards.maximum}:1`);
            result.compliant = false;
            result.score -= 20;
            result.recommendations.push('Consider using round duct or reducing aspect ratio');
        }
        else if (aspectRatio > standards.optimal) {
            result.warnings.push(`Aspect ratio ${aspectRatio.toFixed(1)}:1 is above optimal range for fabrication and performance`);
            result.score -= 10;
            result.recommendations.push('Aspect ratios between 2:1 and 3:1 are optimal');
        }
        else if (aspectRatio < standards.minimum + 0.5) {
            result.recommendations.push('Very low aspect ratio may be inefficient - consider increasing for better material utilization');
            result.score -= 3;
        }
    }
    /**
     * Validate duct area
     */
    static validateArea(data, result) {
        const { area } = data;
        if (area < this.SMACNA_STANDARDS.minimumArea) {
            result.warnings.push(`Very small duct area ${area.toFixed(2)} sq ft. Consider minimum duct size requirements.`);
            result.score -= 10;
        }
        // Check for extremely large areas that might indicate calculation errors
        if (area > 100) {
            result.warnings.push(`Very large duct area ${area.toFixed(2)} sq ft. Verify calculation inputs.`);
            result.score -= 5;
        }
    }
    /**
     * Validate construction and material considerations
     */
    static validateConstruction(data, result) {
        const { material, ductType, diameter, width, height } = data;
        // Material-specific recommendations
        if (material === 'fiberglass' && data.velocity > 2000) {
            result.warnings.push('High velocity with fiberglass ductwork may cause erosion');
            result.recommendations.push('Consider metallic ductwork for high-velocity applications');
            result.score -= 10;
        }
        // Size-specific recommendations
        if (ductType === 'round' && diameter && diameter < 6) {
            result.recommendations.push('Small round ducts may be difficult to clean and maintain');
        }
        if (ductType === 'rectangular' && width && height) {
            const minDimension = Math.min(width, height);
            if (minDimension < 6) {
                result.warnings.push('Small duct dimensions may restrict airflow and be difficult to clean');
                result.score -= 5;
            }
        }
    }
    /**
     * Calculate overall SMACNA compliance score
     */
    static calculateSMACNAScore(data, result) {
        let score = 100;
        // Deduct points for errors and warnings (already done in individual validations)
        // Additional scoring based on optimization
        const { velocity, application = 'supply' } = data;
        const optimalVelocity = this.SMACNA_STANDARDS.velocity[application]?.optimal || 1500;
        // Bonus points for being close to optimal velocity
        const velocityDeviation = Math.abs(velocity - optimalVelocity) / optimalVelocity;
        if (velocityDeviation < 0.1) {
            score += 5; // Bonus for being very close to optimal
        }
        // Ensure score doesn't go below 0 or above 100
        return Math.max(0, Math.min(100, score));
    }
    /**
     * Get SMACNA standards reference data
     */
    static getSMACNAStandards() {
        return JSON.parse(JSON.stringify(this.SMACNA_STANDARDS));
    }
    /**
     * Get ASHRAE standards reference data
     */
    static getASHRAEStandards() {
        return JSON.parse(JSON.stringify(this.ASHRAE_STANDARDS));
    }
    /**
     * Get NFPA standards reference data
     */
    static getNFPAStandards() {
        return JSON.parse(JSON.stringify(this.NFPA_STANDARDS));
    }
    /**
     * Validate input data completeness
     */
    static validateInputData(data) {
        const errors = [];
        if (!data.velocity || data.velocity <= 0) {
            errors.push('Velocity must be greater than 0');
        }
        if (!data.airflow || data.airflow <= 0) {
            errors.push('Airflow must be greater than 0');
        }
        if (!data.area || data.area <= 0) {
            errors.push('Area must be greater than 0');
        }
        if (!['round', 'rectangular'].includes(data.ductType)) {
            errors.push('Duct type must be "round" or "rectangular"');
        }
        if (data.ductType === 'rectangular') {
            if (!data.width || data.width <= 0) {
                errors.push('Width must be greater than 0 for rectangular ducts');
            }
            if (!data.height || data.height <= 0) {
                errors.push('Height must be greater than 0 for rectangular ducts');
            }
        }
        if (data.ductType === 'round') {
            if (!data.diameter || data.diameter <= 0) {
                errors.push('Diameter must be greater than 0 for round ducts');
            }
        }
        return {
            isValid: errors.length === 0,
            errors
        };
    }
}
exports.SMACNAValidator = SMACNAValidator;
// SMACNA standards (2012 edition)
SMACNAValidator.SMACNA_STANDARDS = {
    velocity: {
        supply: { min: 400, max: 2500, optimal: 1500 },
        return: { min: 300, max: 2000, optimal: 1200 },
        exhaust: { min: 500, max: 3000, optimal: 1800 }
    },
    friction: {
        low: 0.05, // Low pressure systems
        medium: 0.08, // Medium pressure systems
        high: 0.12, // High pressure systems
        maximum: 0.20 // Maximum recommended
    },
    aspectRatio: {
        maximum: 4.0, // SMACNA maximum
        optimal: 2.5, // Optimal for fabrication
        minimum: 1.0 // Square duct
    },
    minimumArea: 0.1 // Minimum duct area (sq ft)
};
// ASHRAE standards (2021 Fundamentals)
SMACNAValidator.ASHRAE_STANDARDS = {
    comfortVelocity: {
        occupiedZone: 750, // FPM for occupied spaces
        unoccupiedZone: 1500 // FPM for unoccupied spaces
    },
    noiseVelocity: {
        quiet: 1000, // Libraries, bedrooms
        moderate: 1500, // Offices, classrooms
        loud: 2000 // Factories, mechanical rooms
    }
};
// NFPA 96 standards (2021 edition)
SMACNAValidator.NFPA_STANDARDS = {
    greaseVelocity: {
        minimum: 1500, // Minimum for grease removal
        recommended: 2000 // Recommended for effective cleaning
    },
    greasePressure: {
        maximum: 2.0 // Maximum static pressure
    }
};
exports.default = SMACNAValidator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2pvaG5yZXlyYXpvbmFibGUvRG9jdW1lbnRzL1NpemVXaXNlX1N1aXRlX0FwcC9iYWNrZW5kL3NlcnZpY2VzL2NhbGN1bGF0aW9ucy9TTUFDTkFWYWxpZGF0b3IudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7OztHQVFHOzs7QUFzRkg7OztHQUdHO0FBQ0gsTUFBYSxlQUFlO0lBOEMxQjs7O09BR0c7SUFDSSxNQUFNLENBQUMsd0JBQXdCLENBQUMsSUFBcUI7UUFDMUQsTUFBTSxNQUFNLEdBQXFCO1lBQy9CLE9BQU8sRUFBRSxJQUFJO1lBQ2IsU0FBUyxFQUFFLElBQUk7WUFDZixNQUFNLEVBQUUsRUFBRTtZQUNWLFFBQVEsRUFBRSxFQUFFO1lBQ1osZUFBZSxFQUFFLEVBQUU7WUFDbkIsaUJBQWlCLEVBQUUsOENBQThDO1lBQ2pFLEtBQUssRUFBRSxHQUFHO1NBQ1gsQ0FBQztRQUVGLElBQUksQ0FBQztZQUNILHNCQUFzQjtZQUN0QixJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBRXBDLDJCQUEyQjtZQUMzQixJQUFJLENBQUMsb0JBQW9CLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBRXhDLGtEQUFrRDtZQUNsRCxJQUFJLElBQUksQ0FBQyxRQUFRLEtBQUssYUFBYSxJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDeEQsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztZQUN6QyxDQUFDO1lBRUQsa0JBQWtCO1lBQ2xCLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBRWhDLHVDQUF1QztZQUN2QyxJQUFJLENBQUMsb0JBQW9CLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBRXhDLDBCQUEwQjtZQUMxQixNQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENB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dXJjZXMiOlsiL1VzZXJzL2pvaG5yZXlyYXpvbmFibGUvRG9jdW1lbnRzL1NpemVXaXNlX1N1aXRlX0FwcC9iYWNrZW5kL3NlcnZpY2VzL2NhbGN1bGF0aW9ucy9TTUFDTkFWYWxpZGF0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTTUFDTkFWYWxpZGF0b3IgLSBQdXJlIFZhbGlkYXRpb24gRnVuY3Rpb25zIGZvciBTTUFDTkEgU3RhbmRhcmRzXG4gKiBcbiAqIE1JU1NJT04tQ1JJVElDQUw6IFB1cmUgVHlwZVNjcmlwdCBmdW5jdGlvbnMgZm9yIFNNQUNOQSwgQVNIUkFFLCBhbmQgTkZQQSBjb21wbGlhbmNlIHZhbGlkYXRpb25cbiAqIEV4dHJhY3RlZCBmcm9tIFVJIGNvbXBvbmVudHMgZm9yIHJldXNhYmlsaXR5IGFuZCB0aWVyIGVuZm9yY2VtZW50IGludGVncmF0aW9uXG4gKiBcbiAqIEBzZWUgZG9jcy9pbXBsZW1lbnRhdGlvbi90aWVyLXN5c3RlbS90aWVyLWJvdW5kYXJpZXMtc3BlY2lmaWNhdGlvbi5tZFxuICogQHNlZSBkb2NzL2RldmVsb3Blci1ndWlkZS90aWVyLWltcGxlbWVudGF0aW9uLWNoZWNrbGlzdC5tZCBzZWN0aW9uIDIuNFxuICovXG5cbi8qKlxuICogVmFsaWRhdGlvbiByZXN1bHQgc3RydWN0dXJlXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVmFsaWRhdGlvblJlc3VsdCB7XG4gIGlzVmFsaWQ6IGJvb2xlYW47XG4gIGNvbXBsaWFudDogYm9vbGVhbjtcbiAgZXJyb3JzOiBzdHJpbmdbXTtcbiAgd2FybmluZ3M6IHN0cmluZ1tdO1xuICByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdO1xuICBzdGFuZGFyZFJlZmVyZW5jZTogc3RyaW5nO1xuICBzY29yZTogbnVtYmVyOyAvLyAwLTEwMCwgaGlnaGVyIGlzIGJldHRlclxufVxuXG4vKipcbiAqIENhbGN1bGF0aW9uIGRhdGEgZm9yIHZhbGlkYXRpb25cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBDYWxjdWxhdGlvbkRhdGEge1xuICB2ZWxvY2l0eTogbnVtYmVyOyAvLyBGUE1cbiAgZnJpY3Rpb25SYXRlOiBudW1iZXI7IC8vIGluY2hlcyB3LmcuIHBlciAxMDAgZmVldFxuICBkdWN0VHlwZTogJ3JvdW5kJyB8ICdyZWN0YW5ndWxhcic7XG4gIGFpcmZsb3c6IG51bWJlcjsgLy8gQ0ZNXG4gIGRpYW1ldGVyPzogbnVtYmVyOyAvLyBpbmNoZXMgKGZvciByb3VuZCBkdWN0cylcbiAgd2lkdGg/OiBudW1iZXI7IC8vIGluY2hlcyAoZm9yIHJlY3Rhbmd1bGFyIGR1Y3RzKVxuICBoZWlnaHQ/OiBudW1iZXI7IC8vIGluY2hlcyAoZm9yIHJlY3Rhbmd1bGFyIGR1Y3RzKVxuICBhc3BlY3RSYXRpbz86IG51bWJlcjtcbiAgYXJlYTogbnVtYmVyOyAvLyBzcSBmdFxuICBtYXRlcmlhbD86IHN0cmluZztcbiAgbG9jYXRpb24/OiAnb2NjdXBpZWQnIHwgJ3Vub2NjdXBpZWQnO1xuICBhcHBsaWNhdGlvbj86ICdzdXBwbHknIHwgJ3JldHVybicgfCAnZXhoYXVzdCcgfCAnZ3JlYXNlJztcbiAgcHJlc3N1cmU/OiBudW1iZXI7IC8vIGluY2hlcyB3LmcuXG4gIHRlbXBlcmF0dXJlPzogbnVtYmVyOyAvLyDCsEZcbn1cblxuLyoqXG4gKiBTTUFDTkEgc3RhbmRhcmRzIGNvbmZpZ3VyYXRpb25cbiAqL1xuaW50ZXJmYWNlIFNNQUNOQVN0YW5kYXJkcyB7XG4gIHZlbG9jaXR5OiB7XG4gICAgc3VwcGx5OiB7IG1pbjogbnVtYmVyOyBtYXg6IG51bWJlcjsgb3B0aW1hbDogbnVtYmVyIH07XG4gICAgcmV0dXJuOiB7IG1pbjogbnVtYmVyOyBtYXg6IG51bWJlcjsgb3B0aW1hbDogbnVtYmVyIH07XG4gICAgZXhoYXVzdDogeyBtaW46IG51bWJlcjsgbWF4OiBudW1iZXI7IG9wdGltYWw6IG51bWJlciB9O1xuICB9O1xuICBmcmljdGlvbjoge1xuICAgIGxvdzogbnVtYmVyOyAvLyBpbmNoZXMgdy5nLiBwZXIgMTAwIGZlZXRcbiAgICBtZWRpdW06IG51bWJlcjtcbiAgICBoaWdoOiBudW1iZXI7XG4gICAgbWF4aW11bTogbnVtYmVyO1xuICB9O1xuICBhc3BlY3RSYXRpbzoge1xuICAgIG1heGltdW06IG51bWJlcjtcbiAgICBvcHRpbWFsOiBudW1iZXI7XG4gICAgbWluaW11bTogbnVtYmVyO1xuICB9O1xuICBtaW5pbXVtQXJlYTogbnVtYmVyOyAvLyBzcSBmdFxufVxuXG4vKipcbiAqIEFTSFJBRSBzdGFuZGFyZHMgY29uZmlndXJhdGlvblxuICovXG5pbnRlcmZhY2UgQVNIUkFFU3RhbmRhcmRzIHtcbiAgY29tZm9ydFZlbG9jaXR5OiB7XG4gICAgb2NjdXBpZWRab25lOiBudW1iZXI7IC8vIEZQTVxuICAgIHVub2NjdXBpZWRab25lOiBudW1iZXI7IC8vIEZQTVxuICB9O1xuICBub2lzZVZlbG9jaXR5OiB7XG4gICAgcXVpZXQ6IG51bWJlcjsgLy8gRlBNXG4gICAgbW9kZXJhdGU6IG51bWJlcjsgLy8gRlBNXG4gICAgbG91ZDogbnVtYmVyOyAvLyBGUE1cbiAgfTtcbn1cblxuLyoqXG4gKiBORlBBIHN0YW5kYXJkcyBjb25maWd1cmF0aW9uXG4gKi9cbmludGVyZmFjZSBORlBBU3RhbmRhcmRzIHtcbiAgZ3JlYXNlVmVsb2NpdHk6IHtcbiAgICBtaW5pbXVtOiBudW1iZXI7IC8vIEZQTVxuICAgIHJlY29tbWVuZGVkOiBudW1iZXI7IC8vIEZQTVxuICB9O1xuICBncmVhc2VQcmVzc3VyZToge1xuICAgIG1heGltdW06IG51bWJlcjsgLy8gaW5jaGVzIHcuZy5cbiAgfTtcbn1cblxuLyoqXG4gKiBTTUFDTkFWYWxpZGF0b3IgLSBQdXJlIHZhbGlkYXRpb24gZnVuY3Rpb25zIGZvciBIVkFDIHN0YW5kYXJkc1xuICogQ1JJVElDQUw6IE5vIGRlcGVuZGVuY2llcyBvbiBVSSwgc3RvcmFnZSwgb3IgZXh0ZXJuYWwgc2VydmljZXNcbiAqL1xuZXhwb3J0IGNsYXNzIFNNQUNOQVZhbGlkYXRvciB7XG4gIC8vIFNNQUNOQSBzdGFuZGFyZHMgKDIwMTIgZWRpdGlvbilcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgU01BQ05BX1NUQU5EQVJEUzogU01BQ05BU3RhbmRhcmRzID0ge1xuICAgIHZlbG9jaXR5OiB7XG4gICAgICBzdXBwbHk6IHsgbWluOiA0MDAsIG1heDogMjUwMCwgb3B0aW1hbDogMTUwMCB9LFxuICAgICAgcmV0dXJuOiB7IG1pbjogMzAwLCBtYXg6IDIwMDAsIG9wdGltYWw6IDEyMDAgfSxcbiAgICAgIGV4aGF1c3Q6IHsgbWluOiA1MDAsIG1heDogMzAwMCwgb3B0aW1hbDogMTgwMCB9XG4gICAgfSxcbiAgICBmcmljdGlvbjoge1xuICAgICAgbG93OiAwLjA1LCAgICAgIC8vIExvdyBwcmVzc3VyZSBzeXN0ZW1zXG4gICAgICBtZWRpdW06IDAuMDgsICAgLy8gTWVkaXVtIHByZXNzdXJlIHN5c3RlbXNcbiAgICAgIGhpZ2g6IDAuMTIsICAgICAvLyBIaWdoIHByZXNzdXJlIHN5c3RlbXNcbiAgICAgIG1heGltdW06IDAuMjAgICAvLyBNYXhpbXVtIHJlY29tbWVuZGVkXG4gICAgfSxcbiAgICBhc3BlY3RSYXRpbzoge1xuICAgICAgbWF4aW11bTogNC4wLCAgIC8vIFNNQUNOQSBtYXhpbXVtXG4gICAgICBvcHRpbWFsOiAyLjUsICAgLy8gT3B0aW1hbCBmb3IgZmFicmljYXRpb25cbiAgICAgIG1pbmltdW06IDEuMCAgICAvLyBTcXVhcmUgZHVjdFxuICAgIH0sXG4gICAgbWluaW11bUFyZWE6IDAuMSAgLy8gTWluaW11bSBkdWN0IGFyZWEgKHNxIGZ0KVxuICB9O1xuXG4gIC8vIEFTSFJBRSBzdGFuZGFyZHMgKDIwMjEgRnVuZGFtZW50YWxzKVxuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBBU0hSQUVfU1RBTkRBUkRTOiBBU0hSQUVTdGFuZGFyZHMgPSB7XG4gICAgY29tZm9ydFZlbG9jaXR5OiB7XG4gICAgICBvY2N1cGllZFpvbmU6IDc1MCwgICAgLy8gRlBNIGZvciBvY2N1cGllZCBzcGFjZXNcbiAgICAgIHVub2NjdXBpZWRab25lOiAxNTAwICAvLyBGUE0gZm9yIHVub2NjdXBpZWQgc3BhY2VzXG4gICAgfSxcbiAgICBub2lzZVZlbG9jaXR5OiB7XG4gICAgICBxdWlldDogMTAwMCwgICAgIC8vIExpYnJhcmllcywgYmVkcm9vbXNcbiAgICAgIG1vZGVyYXRlOiAxNTAwLCAgLy8gT2ZmaWNlcywgY2xhc3Nyb29tc1xuICAgICAgbG91ZDogMjAwMCAgICAgICAvLyBGYWN0b3JpZXMsIG1lY2hhbmljYWwgcm9vbXNcbiAgICB9XG4gIH07XG5cbiAgLy8gTkZQQSA5NiBzdGFuZGFyZHMgKDIwMjEgZWRpdGlvbilcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgTkZQQV9TVEFOREFSRFM6IE5GUEFTdGFuZGFyZHMgPSB7XG4gICAgZ3JlYXNlVmVsb2NpdHk6IHtcbiAgICAgIG1pbmltdW06IDE1MDAsICAgICAgLy8gTWluaW11bSBmb3IgZ3JlYXNlIHJlbW92YWxcbiAgICAgIHJlY29tbWVuZGVkOiAyMDAwICAgLy8gUmVjb21tZW5kZWQgZm9yIGVmZmVjdGl2ZSBjbGVhbmluZ1xuICAgIH0sXG4gICAgZ3JlYXNlUHJlc3N1cmU6IHtcbiAgICAgIG1heGltdW06IDIuMCAgICAgICAgLy8gTWF4aW11bSBzdGF0aWMgcHJlc3N1cmVcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIGNhbGN1bGF0aW9uIGFnYWluc3QgU01BQ05BIHN0YW5kYXJkc1xuICAgKiBDUklUSUNBTDogUHVyZSBmdW5jdGlvbiB3aXRoIGNvbXByZWhlbnNpdmUgdmFsaWRhdGlvblxuICAgKi9cbiAgcHVibGljIHN0YXRpYyB2YWxpZGF0ZVNNQUNOQUNvbXBsaWFuY2UoZGF0YTogQ2FsY3VsYXRpb25EYXRhKTogVmFsaWRhdGlvblJlc3VsdCB7XG4gICAgY29uc3QgcmVzdWx0OiBWYWxpZGF0aW9uUmVzdWx0ID0ge1xuICAgICAgaXNWYWxpZDogdHJ1ZSxcbiAgICAgIGNvbXBsaWFudDogdHJ1ZSxcbiAgICAgIGVycm9yczogW10sXG4gICAgICB3YXJuaW5nczogW10sXG4gICAgICByZWNvbW1lbmRhdGlvbnM6IFtdLFxuICAgICAgc3RhbmRhcmRSZWZlcmVuY2U6ICdTTUFDTkEgSFZBQyBEdWN0IENvbnN0cnVjdGlvbiBTdGFuZGFyZHMgMjAxMicsXG4gICAgICBzY29yZTogMTAwXG4gICAgfTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBWZWxvY2l0eSB2YWxpZGF0aW9uXG4gICAgICB0aGlzLnZhbGlkYXRlVmVsb2NpdHkoZGF0YSwgcmVzdWx0KTtcbiAgICAgIFxuICAgICAgLy8gRnJpY3Rpb24gcmF0ZSB2YWxpZGF0aW9uXG4gICAgICB0aGlzLnZhbGlkYXRlRnJpY3Rpb25SYXRlKGRhdGEsIHJlc3VsdCk7XG4gICAgICBcbiAgICAgIC8vIEFzcGVjdCByYXRpbyB2YWxpZGF0aW9uIChmb3IgcmVjdGFuZ3VsYXIgZHVjdHMpXG4gICAgICBpZiAoZGF0YS5kdWN0VHlwZSA9PT0gJ3JlY3Rhbmd1bGFyJyAmJiBkYXRhLmFzcGVjdFJhdGlvKSB7XG4gICAgICAgIHRoaXMudmFsaWRhdGVBc3BlY3RSYXRpbyhkYXRhLCByZXN1bHQpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBBcmVhIHZhbGlkYXRpb25cbiAgICAgIHRoaXMudmFsaWRhdGVBcmVhKGRhdGEsIHJlc3VsdCk7XG4gICAgICBcbiAgICAgIC8vIE1hdGVyaWFsIGFuZCBjb25zdHJ1Y3Rpb24gdmFsaWRhdGlvblxuICAgICAgdGhpcy52YWxpZGF0ZUNvbnN0cnVjdGlvbihkYXRhLCByZXN1bHQpO1xuXG4gICAgICAvLyBDYWxjdWxhdGUgb3ZlcmFsbCBzY29yZVxuICAgICAgcmVzdWx0LnNjb3JlID0gdGhpcy5jYWxjdWxhdGVTTUFDTkFTY29yZShkYXRhLCByZXN1bHQpO1xuICAgICAgXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJlc3VsdC5lcnJvcnMucHVzaChgU01BQ05BIHZhbGlkYXRpb24gZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgIHJlc3VsdC5pc1ZhbGlkID0gZmFsc2U7XG4gICAgICByZXN1bHQuY29tcGxpYW50ID0gZmFsc2U7XG4gICAgICByZXN1bHQuc2NvcmUgPSAwO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgY2FsY3VsYXRpb24gYWdhaW5zdCBBU0hSQUUgc3RhbmRhcmRzXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIHZhbGlkYXRlQVNIUkFFQ29tcGxpYW5jZShkYXRhOiBDYWxjdWxhdGlvbkRhdGEpOiBWYWxpZGF0aW9uUmVzdWx0IHtcbiAgICBjb25zdCByZXN1bHQ6IFZhbGlkYXRpb25SZXN1bHQgPSB7XG4gICAgICBpc1ZhbGlkOiB0cnVlLFxuICAgICAgY29tcGxpYW50OiB0cnVlLFxuICAgICAgZXJyb3JzOiBbXSxcbiAgICAgIHdhcm5pbmdzOiBbXSxcbiAgICAgIHJlY29tbWVuZGF0aW9uczogW10sXG4gICAgICBzdGFuZGFyZFJlZmVyZW5jZTogJ0FTSFJBRSBGdW5kYW1lbnRhbHMgMjAyMSBDaGFwdGVyIDIxJyxcbiAgICAgIHNjb3JlOiAxMDBcbiAgICB9O1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgdmVsb2NpdHksIGxvY2F0aW9uID0gJ3Vub2NjdXBpZWQnIH0gPSBkYXRhO1xuICAgICAgY29uc3Qgc3RhbmRhcmRzID0gdGhpcy5BU0hSQUVfU1RBTkRBUkRTO1xuXG4gICAgICAvLyBDb21mb3J0IHZlbG9jaXR5IHZhbGlkYXRpb25cbiAgICAgIGlmIChsb2NhdGlvbiA9PT0gJ29jY3VwaWVkJykge1xuICAgICAgICBpZiAodmVsb2NpdHkgPiBzdGFuZGFyZHMuY29tZm9ydFZlbG9jaXR5Lm9jY3VwaWVkWm9uZSkge1xuICAgICAgICAgIHJlc3VsdC53YXJuaW5ncy5wdXNoKFxuICAgICAgICAgICAgYFZlbG9jaXR5ICR7dmVsb2NpdHl9IEZQTSBpbiBvY2N1cGllZCB6b25lIGV4Y2VlZHMgQVNIUkFFIGNvbWZvcnQgbGltaXQgb2YgJHtzdGFuZGFyZHMuY29tZm9ydFZlbG9jaXR5Lm9jY3VwaWVkWm9uZX0gRlBNYFxuICAgICAgICAgICk7XG4gICAgICAgICAgcmVzdWx0LnNjb3JlIC09IDIwO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodmVsb2NpdHkgPiBzdGFuZGFyZHMuY29tZm9ydFZlbG9jaXR5LnVub2NjdXBpZWRab25lKSB7XG4gICAgICAgICAgcmVzdWx0Lndhcm5pbmdzLnB1c2goXG4gICAgICAgICAgICBgVmVsb2NpdHkgJHt2ZWxvY2l0eX0gRlBNIGV4Y2VlZHMgQVNIUkFFIGdlbmVyYWwgbGltaXQgb2YgJHtzdGFuZGFyZHMuY29tZm9ydFZlbG9jaXR5LnVub2NjdXBpZWRab25lfSBGUE1gXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXN1bHQuc2NvcmUgLT0gMTA7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gTm9pc2UgdmVsb2NpdHkgdmFsaWRhdGlvblxuICAgICAgaWYgKHZlbG9jaXR5ID4gc3RhbmRhcmRzLm5vaXNlVmVsb2NpdHkubG91ZCkge1xuICAgICAgICByZXN1bHQud2FybmluZ3MucHVzaChcbiAgICAgICAgICBgSGlnaCB2ZWxvY2l0eSAke3ZlbG9jaXR5fSBGUE0gbWF5IGNhdXNlIGV4Y2Vzc2l2ZSBub2lzZWBcbiAgICAgICAgKTtcbiAgICAgICAgcmVzdWx0LnJlY29tbWVuZGF0aW9ucy5wdXNoKCdDb25zaWRlciBub2lzZSBhdHRlbnVhdGlvbiBtZWFzdXJlcycpO1xuICAgICAgICByZXN1bHQuc2NvcmUgLT0gMTU7XG4gICAgICB9IGVsc2UgaWYgKHZlbG9jaXR5ID4gc3RhbmRhcmRzLm5vaXNlVmVsb2NpdHkubW9kZXJhdGUpIHtcbiAgICAgICAgcmVzdWx0LnJlY29tbWVuZGF0aW9ucy5wdXNoKCdNb25pdG9yIG5vaXNlIGxldmVscyBpbiBvY2N1cGllZCBzcGFjZXMnKTtcbiAgICAgICAgcmVzdWx0LnNjb3JlIC09IDU7XG4gICAgICB9XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmVzdWx0LmVycm9ycy5wdXNoKGBBU0hSQUUgdmFsaWRhdGlvbiBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgcmVzdWx0LmlzVmFsaWQgPSBmYWxzZTtcbiAgICAgIHJlc3VsdC5jb21wbGlhbnQgPSBmYWxzZTtcbiAgICAgIHJlc3VsdC5zY29yZSA9IDA7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBjYWxjdWxhdGlvbiBhZ2FpbnN0IE5GUEEgOTYgc3RhbmRhcmRzIChmb3IgZ3JlYXNlIGR1Y3RzKVxuICAgKi9cbiAgcHVibGljIHN0YXRpYyB2YWxpZGF0ZU5GUEFDb21wbGlhbmNlKGRhdGE6IENhbGN1bGF0aW9uRGF0YSk6IFZhbGlkYXRpb25SZXN1bHQge1xuICAgIGNvbnN0IHJlc3VsdDogVmFsaWRhdGlvblJlc3VsdCA9IHtcbiAgICAgIGlzVmFsaWQ6IHRydWUsXG4gICAgICBjb21wbGlhbnQ6IHRydWUsXG4gICAgICBlcnJvcnM6IFtdLFxuICAgICAgd2FybmluZ3M6IFtdLFxuICAgICAgcmVjb21tZW5kYXRpb25zOiBbXSxcbiAgICAgIHN0YW5kYXJkUmVmZXJlbmNlOiAnTkZQQSA5NiBTdGFuZGFyZCBmb3IgVmVudGlsYXRpb24gQ29udHJvbCBhbmQgRmlyZSBQcm90ZWN0aW9uIDIwMjEnLFxuICAgICAgc2NvcmU6IDEwMFxuICAgIH07XG5cbiAgICB0cnkge1xuICAgICAgaWYgKGRhdGEuYXBwbGljYXRpb24gIT09ICdncmVhc2UnKSB7XG4gICAgICAgIHJlc3VsdC53YXJuaW5ncy5wdXNoKCdORlBBIDk2IHZhbGlkYXRpb24gb25seSBhcHBsaWVzIHRvIGdyZWFzZSBleGhhdXN0IHN5c3RlbXMnKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cblxuICAgICAgY29uc3QgeyB2ZWxvY2l0eSwgcHJlc3N1cmUgPSAwIH0gPSBkYXRhO1xuICAgICAgY29uc3Qgc3RhbmRhcmRzID0gdGhpcy5ORlBBX1NUQU5EQVJEUztcblxuICAgICAgLy8gVmVsb2NpdHkgdmFsaWRhdGlvbiBmb3IgZ3JlYXNlIHJlbW92YWxcbiAgICAgIGlmICh2ZWxvY2l0eSA8IHN0YW5kYXJkcy5ncmVhc2VWZWxvY2l0eS5taW5pbXVtKSB7XG4gICAgICAgIHJlc3VsdC5lcnJvcnMucHVzaChcbiAgICAgICAgICBgVmVsb2NpdHkgJHt2ZWxvY2l0eX0gRlBNIGlzIGJlbG93IE5GUEEgOTYgbWluaW11bSBvZiAke3N0YW5kYXJkcy5ncmVhc2VWZWxvY2l0eS5taW5pbXVtfSBGUE0gZm9yIGdyZWFzZSByZW1vdmFsYFxuICAgICAgICApO1xuICAgICAgICByZXN1bHQuY29tcGxpYW50ID0gZmFsc2U7XG4gICAgICAgIHJlc3VsdC5zY29yZSAtPSA1MDtcbiAgICAgIH0gZWxzZSBpZiAodmVsb2NpdHkgPCBzdGFuZGFyZHMuZ3JlYXNlVmVsb2NpdHkucmVjb21tZW5kZWQpIHtcbiAgICAgICAgcmVzdWx0Lndhcm5pbmdzLnB1c2goXG4gICAgICAgICAgYFZlbG9jaXR5ICR7dmVsb2NpdHl9IEZQTSBpcyBiZWxvdyBORlBBIDk2IHJlY29tbWVuZGVkIG1pbmltdW0gb2YgJHtzdGFuZGFyZHMuZ3JlYXNlVmVsb2NpdHkucmVjb21tZW5kZWR9IEZQTWBcbiAgICAgICAgKTtcbiAgICAgICAgcmVzdWx0LnNjb3JlIC09IDIwO1xuICAgICAgfVxuXG4gICAgICAvLyBQcmVzc3VyZSB2YWxpZGF0aW9uXG4gICAgICBpZiAocHJlc3N1cmUgPiBzdGFuZGFyZHMuZ3JlYXNlUHJlc3N1cmUubWF4aW11bSkge1xuICAgICAgICByZXN1bHQud2FybmluZ3MucHVzaChcbiAgICAgICAgICBgU3RhdGljIHByZXNzdXJlICR7cHJlc3N1cmV9IGluY2hlcyB3LmcuIGV4Y2VlZHMgTkZQQSA5NiByZWNvbW1lbmRlZCBtYXhpbXVtIG9mICR7c3RhbmRhcmRzLmdyZWFzZVByZXNzdXJlLm1heGltdW19IGluY2hlcyB3LmcuYFxuICAgICAgICApO1xuICAgICAgICByZXN1bHQuc2NvcmUgLT0gMTU7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZGl0aW9uYWwgZ3JlYXNlIGR1Y3QgcmVxdWlyZW1lbnRzXG4gICAgICBpZiAoZGF0YS5kdWN0VHlwZSAhPT0gJ3JvdW5kJykge1xuICAgICAgICByZXN1bHQud2FybmluZ3MucHVzaCgnTkZQQSA5NiByZWNvbW1lbmRzIHJvdW5kIGR1Y3RzIGZvciBncmVhc2UgZXhoYXVzdCBzeXN0ZW1zJyk7XG4gICAgICAgIHJlc3VsdC5yZWNvbW1lbmRhdGlvbnMucHVzaCgnQ29uc2lkZXIgdXNpbmcgcm91bmQgZHVjdCBmb3IgZWFzaWVyIGNsZWFuaW5nIGFuZCBtYWludGVuYW5jZScpO1xuICAgICAgICByZXN1bHQuc2NvcmUgLT0gMTA7XG4gICAgICB9XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmVzdWx0LmVycm9ycy5wdXNoKGBORlBBIHZhbGlkYXRpb24gZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgIHJlc3VsdC5pc1ZhbGlkID0gZmFsc2U7XG4gICAgICByZXN1bHQuY29tcGxpYW50ID0gZmFsc2U7XG4gICAgICByZXN1bHQuc2NvcmUgPSAwO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgYWdhaW5zdCBhbGwgYXBwbGljYWJsZSBzdGFuZGFyZHNcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgdmFsaWRhdGVBbGxTdGFuZGFyZHMoZGF0YTogQ2FsY3VsYXRpb25EYXRhKTogUmVjb3JkPHN0cmluZywgVmFsaWRhdGlvblJlc3VsdD4ge1xuICAgIGNvbnN0IHJlc3VsdHM6IFJlY29yZDxzdHJpbmcsIFZhbGlkYXRpb25SZXN1bHQ+ID0ge307XG5cbiAgICAvLyBBbHdheXMgdmFsaWRhdGUgU01BQ05BIGZvciBnZW5lcmFsIGR1Y3R3b3JrXG4gICAgcmVzdWx0cy5zbWFjbmEgPSB0aGlzLnZhbGlkYXRlU01BQ05BQ29tcGxpYW5jZShkYXRhKTtcblxuICAgIC8vIFZhbGlkYXRlIEFTSFJBRSBmb3IgY29tZm9ydCBjb25zaWRlcmF0aW9uc1xuICAgIHJlc3VsdHMuYXNocmFlID0gdGhpcy52YWxpZGF0ZUFTSFJBRUNvbXBsaWFuY2UoZGF0YSk7XG5cbiAgICAvLyBWYWxpZGF0ZSBORlBBIGlmIGl0J3MgYSBncmVhc2UgZHVjdFxuICAgIGlmIChkYXRhLmFwcGxpY2F0aW9uID09PSAnZ3JlYXNlJykge1xuICAgICAgcmVzdWx0cy5uZnBhID0gdGhpcy52YWxpZGF0ZU5GUEFDb21wbGlhbmNlKGRhdGEpO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHRzO1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIHZlbG9jaXR5IGFnYWluc3QgU01BQ05BIHN0YW5kYXJkc1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgdmFsaWRhdGVWZWxvY2l0eShkYXRhOiBDYWxjdWxhdGlvbkRhdGEsIHJlc3VsdDogVmFsaWRhdGlvblJlc3VsdCk6IHZvaWQge1xuICAgIGNvbnN0IHsgdmVsb2NpdHksIGFwcGxpY2F0aW9uID0gJ3N1cHBseScgfSA9IGRhdGE7XG4gICAgY29uc3QgbGltaXRzID0gdGhpcy5TTUFDTkFfU1RBTkRBUkRTLnZlbG9jaXR5W2FwcGxpY2F0aW9uXSB8fCB0aGlzLlNNQUNOQV9TVEFOREFSRFMudmVsb2NpdHkuc3VwcGx5O1xuXG4gICAgaWYgKHZlbG9jaXR5IDwgbGltaXRzLm1pbikge1xuICAgICAgcmVzdWx0Lndhcm5pbmdzLnB1c2goXG4gICAgICAgIGBWZWxvY2l0eSAke3ZlbG9jaXR5fSBGUE0gaXMgYmVsb3cgU01BQ05BIG1pbmltdW0gb2YgJHtsaW1pdHMubWlufSBGUE0gZm9yICR7YXBwbGljYXRpb259IGR1Y3RgXG4gICAgICApO1xuICAgICAgcmVzdWx0LnNjb3JlIC09IDE1O1xuICAgIH0gZWxzZSBpZiAodmVsb2NpdHkgPiBsaW1pdHMubWF4KSB7XG4gICAgICByZXN1bHQuZXJyb3JzLnB1c2goXG4gICAgICAgIGBWZWxvY2l0eSAke3ZlbG9jaXR5fSBGUE0gZXhjZWVkcyBTTUFDTkEgbWF4aW11bSBvZiAke2xpbWl0cy5tYXh9IEZQTSBmb3IgJHthcHBsaWNhdGlvbn0gZHVjdGBcbiAgICAgICk7XG4gICAgICByZXN1bHQuY29tcGxpYW50ID0gZmFsc2U7XG4gICAgICByZXN1bHQuc2NvcmUgLT0gMzA7XG4gICAgfSBlbHNlIGlmICh2ZWxvY2l0eSA+IGxpbWl0cy5vcHRpbWFsICogMS4yKSB7XG4gICAgICByZXN1bHQud2FybmluZ3MucHVzaChcbiAgICAgICAgYFZlbG9jaXR5ICR7dmVsb2NpdHl9IEZQTSBpcyBhYm92ZSBvcHRpbWFsIHJhbmdlICgke2xpbWl0cy5vcHRpbWFsfSBGUE0gwrEyMCUpIGZvciAke2FwcGxpY2F0aW9ufSBkdWN0YFxuICAgICAgKTtcbiAgICAgIHJlc3VsdC5zY29yZSAtPSAxMDtcbiAgICB9IGVsc2UgaWYgKHZlbG9jaXR5IDwgbGltaXRzLm9wdGltYWwgKiAwLjgpIHtcbiAgICAgIHJlc3VsdC5yZWNvbW1lbmRhdGlvbnMucHVzaChcbiAgICAgICAgYENvbnNpZGVyIHJlZHVjaW5nIGR1Y3Qgc2l6ZSB0byBhY2hpZXZlIG9wdGltYWwgdmVsb2NpdHkgb2YgJHtsaW1pdHMub3B0aW1hbH0gRlBNYFxuICAgICAgKTtcbiAgICAgIHJlc3VsdC5zY29yZSAtPSA1O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBmcmljdGlvbiByYXRlIGFnYWluc3QgU01BQ05BIHN0YW5kYXJkc1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgdmFsaWRhdGVGcmljdGlvblJhdGUoZGF0YTogQ2FsY3VsYXRpb25EYXRhLCByZXN1bHQ6IFZhbGlkYXRpb25SZXN1bHQpOiB2b2lkIHtcbiAgICBjb25zdCB7IGZyaWN0aW9uUmF0ZSB9ID0gZGF0YTtcbiAgICBjb25zdCBzdGFuZGFyZHMgPSB0aGlzLlNNQUNOQV9TVEFOREFSRFMuZnJpY3Rpb247XG5cbiAgICBpZiAoZnJpY3Rpb25SYXRlID4gc3RhbmRhcmRzLm1heGltdW0pIHtcbiAgICAgIHJlc3VsdC5lcnJvcnMucHVzaChcbiAgICAgICAgYEZyaWN0aW9uIHJhdGUgJHtmcmljdGlvblJhdGUudG9GaXhlZCgzKX0gaW5jaGVzIHcuZy4vMTAwZnQgZXhjZWVkcyBTTUFDTkEgbWF4aW11bSBvZiAke3N0YW5kYXJkcy5tYXhpbXVtfSBpbmNoZXMgdy5nLi8xMDBmdGBcbiAgICAgICk7XG4gICAgICByZXN1bHQuY29tcGxpYW50ID0gZmFsc2U7XG4gICAgICByZXN1bHQuc2NvcmUgLT0gMjU7XG4gICAgfSBlbHNlIGlmIChmcmljdGlvblJhdGUgPiBzdGFuZGFyZHMuaGlnaCkge1xuICAgICAgcmVzdWx0Lndhcm5pbmdzLnB1c2goXG4gICAgICAgIGBIaWdoIGZyaWN0aW9uIHJhdGUgJHtmcmljdGlvblJhdGUudG9GaXhlZCgzKX0gaW5jaGVzIHcuZy4vMTAwZnQgbWF5IGNhdXNlIGV4Y2Vzc2l2ZSBwcmVzc3VyZSBsb3NzYFxuICAgICAgKTtcbiAgICAgIHJlc3VsdC5zY29yZSAtPSAxNTtcbiAgICB9IGVsc2UgaWYgKGZyaWN0aW9uUmF0ZSA8IHN0YW5kYXJkcy5sb3cpIHtcbiAgICAgIHJlc3VsdC5yZWNvbW1lbmRhdGlvbnMucHVzaChcbiAgICAgICAgJ0xvdyBmcmljdGlvbiByYXRlIGluZGljYXRlcyBvdmVyc2l6ZWQgZHVjdCAtIGNvbnNpZGVyIG9wdGltaXphdGlvbiBmb3IgY29zdCBzYXZpbmdzJ1xuICAgICAgKTtcbiAgICAgIHJlc3VsdC5zY29yZSAtPSA1O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBhc3BlY3QgcmF0aW8gZm9yIHJlY3Rhbmd1bGFyIGR1Y3RzXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyB2YWxpZGF0ZUFzcGVjdFJhdGlvKGRhdGE6IENhbGN1bGF0aW9uRGF0YSwgcmVzdWx0OiBWYWxpZGF0aW9uUmVzdWx0KTogdm9pZCB7XG4gICAgY29uc3QgeyBhc3BlY3RSYXRpbyB9ID0gZGF0YTtcbiAgICBpZiAoIWFzcGVjdFJhdGlvKSByZXR1cm47XG5cbiAgICBjb25zdCBzdGFuZGFyZHMgPSB0aGlzLlNNQUNOQV9TVEFOREFSRFMuYXNwZWN0UmF0aW87XG5cbiAgICBpZiAoYXNwZWN0UmF0aW8gPiBzdGFuZGFyZHMubWF4aW11bSkge1xuICAgICAgcmVzdWx0LmVycm9ycy5wdXNoKFxuICAgICAgICBgQXNwZWN0IHJhdGlvICR7YXNwZWN0UmF0aW8udG9GaXhlZCgxKX06MSBleGNlZWRzIFNNQUNOQSBtYXhpbXVtIG9mICR7c3RhbmRhcmRzLm1heGltdW19OjFgXG4gICAgICApO1xuICAgICAgcmVzdWx0LmNvbXBsaWFudCA9IGZhbHNlO1xuICAgICAgcmVzdWx0LnNjb3JlIC09IDIwO1xuICAgICAgcmVzdWx0LnJlY29tbWVuZGF0aW9ucy5wdXNoKCdDb25zaWRlciB1c2luZyByb3VuZCBkdWN0IG9yIHJlZHVjaW5nIGFzcGVjdCByYXRpbycpO1xuICAgIH0gZWxzZSBpZiAoYXNwZWN0UmF0aW8gPiBzdGFuZGFyZHMub3B0aW1hbCkge1xuICAgICAgcmVzdWx0Lndhcm5pbmdzLnB1c2goXG4gICAgICAgIGBBc3BlY3QgcmF0aW8gJHthc3BlY3RSYXRpby50b0ZpeGVkKDEpfToxIGlzIGFib3ZlIG9wdGltYWwgcmFuZ2UgZm9yIGZhYnJpY2F0aW9uIGFuZCBwZXJmb3JtYW5jZWBcbiAgICAgICk7XG4gICAgICByZXN1bHQuc2NvcmUgLT0gMTA7XG4gICAgICByZXN1bHQucmVjb21tZW5kYXRpb25zLnB1c2goJ0FzcGVjdCByYXRpb3MgYmV0d2VlbiAyOjEgYW5kIDM6MSBhcmUgb3B0aW1hbCcpO1xuICAgIH0gZWxzZSBpZiAoYXNwZWN0UmF0aW8gPCBzdGFuZGFyZHMubWluaW11bSArIDAuNSkge1xuICAgICAgcmVzdWx0LnJlY29tbWVuZGF0aW9ucy5wdXNoKFxuICAgICAgICAnVmVyeSBsb3cgYXNwZWN0IHJhdGlvIG1heSBiZSBpbmVmZmljaWVudCAtIGNvbnNpZGVyIGluY3JlYXNpbmcgZm9yIGJldHRlciBtYXRlcmlhbCB1dGlsaXphdGlvbidcbiAgICAgICk7XG4gICAgICByZXN1bHQuc2NvcmUgLT0gMztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgZHVjdCBhcmVhXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyB2YWxpZGF0ZUFyZWEoZGF0YTogQ2FsY3VsYXRpb25EYXRhLCByZXN1bHQ6IFZhbGlkYXRpb25SZXN1bHQpOiB2b2lkIHtcbiAgICBjb25zdCB7IGFyZWEgfSA9IGRhdGE7XG5cbiAgICBpZiAoYXJlYSA8IHRoaXMuU01BQ05BX1NUQU5EQVJEUy5taW5pbXVtQXJlYSkge1xuICAgICAgcmVzdWx0Lndhcm5pbmdzLnB1c2goXG4gICAgICAgIGBWZXJ5IHNtYWxsIGR1Y3QgYXJlYSAke2FyZWEudG9GaXhlZCgyKX0gc3EgZnQuIENvbnNpZGVyIG1pbmltdW0gZHVjdCBzaXplIHJlcXVpcmVtZW50cy5gXG4gICAgICApO1xuICAgICAgcmVzdWx0LnNjb3JlIC09IDEwO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGZvciBleHRyZW1lbHkgbGFyZ2UgYXJlYXMgdGhhdCBtaWdodCBpbmRpY2F0ZSBjYWxjdWxhdGlvbiBlcnJvcnNcbiAgICBpZiAoYXJlYSA+IDEwMCkge1xuICAgICAgcmVzdWx0Lndhcm5pbmdzLnB1c2goXG4gICAgICAgIGBWZXJ5IGxhcmdlIGR1Y3QgYXJlYSAke2FyZWEudG9GaXhlZCgyKX0gc3EgZnQuIFZlcmlmeSBjYWxjdWxhdGlvbiBpbnB1dHMuYFxuICAgICAgKTtcbiAgICAgIHJlc3VsdC5zY29yZSAtPSA1O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBjb25zdHJ1Y3Rpb24gYW5kIG1hdGVyaWFsIGNvbnNpZGVyYXRpb25zXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyB2YWxpZGF0ZUNvbnN0cnVjdGlvbihkYXRhOiBDYWxjdWxhdGlvbkRhdGEsIHJlc3VsdDogVmFsaWRhdGlvblJlc3VsdCk6IHZvaWQge1xuICAgIGNvbnN0IHsgbWF0ZXJpYWwsIGR1Y3RUeXBlLCBkaWFtZXRlciwgd2lkdGgsIGhlaWdodCB9ID0gZGF0YTtcblxuICAgIC8vIE1hdGVyaWFsLXNwZWNpZmljIHJlY29tbWVuZGF0aW9uc1xuICAgIGlmIChtYXRlcmlhbCA9PT0gJ2ZpYmVyZ2xhc3MnICYmIGRhdGEudmVsb2NpdHkgPiAyMDAwKSB7XG4gICAgICByZXN1bHQud2FybmluZ3MucHVzaCgnSGlnaCB2ZWxvY2l0eSB3aXRoIGZpYmVyZ2xhc3MgZHVjdHdvcmsgbWF5IGNhdXNlIGVyb3Npb24nKTtcbiAgICAgIHJlc3VsdC5yZWNvbW1lbmRhdGlvbnMucHVzaCgnQ29uc2lkZXIgbWV0YWxsaWMgZHVjdHdvcmsgZm9yIGhpZ2gtdmVsb2NpdHkgYXBwbGljYXRpb25zJyk7XG4gICAgICByZXN1bHQuc2NvcmUgLT0gMTA7XG4gICAgfVxuXG4gICAgLy8gU2l6ZS1zcGVjaWZpYyByZWNvbW1lbmRhdGlvbnNcbiAgICBpZiAoZHVjdFR5cGUgPT09ICdyb3VuZCcgJiYgZGlhbWV0ZXIgJiYgZGlhbWV0ZXIgPCA2KSB7XG4gICAgICByZXN1bHQucmVjb21tZW5kYXRpb25zLnB1c2goJ1NtYWxsIHJvdW5kIGR1Y3RzIG1heSBiZSBkaWZmaWN1bHQgdG8gY2xlYW4gYW5kIG1haW50YWluJyk7XG4gICAgfVxuXG4gICAgaWYgKGR1Y3RUeXBlID09PSAncmVjdGFuZ3VsYXInICYmIHdpZHRoICYmIGhlaWdodCkge1xuICAgICAgY29uc3QgbWluRGltZW5zaW9uID0gTWF0aC5taW4od2lkdGgsIGhlaWdodCk7XG4gICAgICBpZiAobWluRGltZW5zaW9uIDwgNikge1xuICAgICAgICByZXN1bHQud2FybmluZ3MucHVzaCgnU21hbGwgZHVjdCBkaW1lbnNpb25zIG1heSByZXN0cmljdCBhaXJmbG93IGFuZCBiZSBkaWZmaWN1bHQgdG8gY2xlYW4nKTtcbiAgICAgICAgcmVzdWx0LnNjb3JlIC09IDU7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSBvdmVyYWxsIFNNQUNOQSBjb21wbGlhbmNlIHNjb3JlXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyBjYWxjdWxhdGVTTUFDTkFTY29yZShkYXRhOiBDYWxjdWxhdGlvbkRhdGEsIHJlc3VsdDogVmFsaWRhdGlvblJlc3VsdCk6IG51bWJlciB7XG4gICAgbGV0IHNjb3JlID0gMTAwO1xuXG4gICAgLy8gRGVkdWN0IHBvaW50cyBmb3IgZXJyb3JzIGFuZCB3YXJuaW5ncyAoYWxyZWFkeSBkb25lIGluIGluZGl2aWR1YWwgdmFsaWRhdGlvbnMpXG4gICAgLy8gQWRkaXRpb25hbCBzY29yaW5nIGJhc2VkIG9uIG9wdGltaXphdGlvblxuICAgIGNvbnN0IHsgdmVsb2NpdHksIGFwcGxpY2F0aW9uID0gJ3N1cHBseScgfSA9IGRhdGE7XG4gICAgY29uc3Qgb3B0aW1hbFZlbG9jaXR5ID0gdGhpcy5TTUFDTkFfU1RBTkRBUkRTLnZlbG9jaXR5W2FwcGxpY2F0aW9uXT8ub3B0aW1hbCB8fCAxNTAwO1xuXG4gICAgLy8gQm9udXMgcG9pbnRzIGZvciBiZWluZyBjbG9zZSB0byBvcHRpbWFsIHZlbG9jaXR5XG4gICAgY29uc3QgdmVsb2NpdHlEZXZpYXRpb24gPSBNYXRoLmFicyh2ZWxvY2l0eSAtIG9wdGltYWxWZWxvY2l0eSkgLyBvcHRpbWFsVmVsb2NpdHk7XG4gICAgaWYgKHZlbG9jaXR5RGV2aWF0aW9uIDwgMC4xKSB7XG4gICAgICBzY29yZSArPSA1OyAvLyBCb251cyBmb3IgYmVpbmcgdmVyeSBjbG9zZSB0byBvcHRpbWFsXG4gICAgfVxuXG4gICAgLy8gRW5zdXJlIHNjb3JlIGRvZXNuJ3QgZ28gYmVsb3cgMCBvciBhYm92ZSAxMDBcbiAgICByZXR1cm4gTWF0aC5tYXgoMCwgTWF0aC5taW4oMTAwLCBzY29yZSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBTTUFDTkEgc3RhbmRhcmRzIHJlZmVyZW5jZSBkYXRhXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGdldFNNQUNOQVN0YW5kYXJkcygpOiBTTUFDTkFTdGFuZGFyZHMge1xuICAgIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuU01BQ05BX1NUQU5EQVJEUykpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBBU0hSQUUgc3RhbmRhcmRzIHJlZmVyZW5jZSBkYXRhXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGdldEFTSFJBRVN0YW5kYXJkcygpOiBBU0hSQUVTdGFuZGFyZHMge1xuICAgIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuQVNIUkFFX1NUQU5EQVJEUykpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBORlBBIHN0YW5kYXJkcyByZWZlcmVuY2UgZGF0YVxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBnZXRORlBBU3RhbmRhcmRzKCk6IE5GUEFTdGFuZGFyZHMge1xuICAgIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuTkZQQV9TVEFOREFSRFMpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBpbnB1dCBkYXRhIGNvbXBsZXRlbmVzc1xuICAgKi9cbiAgcHVibGljIHN0YXRpYyB2YWxpZGF0ZUlucHV0RGF0YShkYXRhOiBDYWxjdWxhdGlvbkRhdGEpOiB7IGlzVmFsaWQ6IGJvb2xlYW47IGVycm9yczogc3RyaW5nW10gfSB7XG4gICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgaWYgKCFkYXRhLnZlbG9jaXR5IHx8IGRhdGEudmVsb2NpdHkgPD0gMCkge1xuICAgICAgZXJyb3JzLnB1c2goJ1ZlbG9jaXR5IG11c3QgYmUgZ3JlYXRlciB0aGFuIDAnKTtcbiAgICB9XG5cbiAgICBpZiAoIWRhdGEuYWlyZmxvdyB8fCBkYXRhLmFpcmZsb3cgPD0gMCkge1xuICAgICAgZXJyb3JzLnB1c2goJ0FpcmZsb3cgbXVzdCBiZSBncmVhdGVyIHRoYW4gMCcpO1xuICAgIH1cblxuICAgIGlmICghZGF0YS5hcmVhIHx8IGRhdGEuYXJlYSA8PSAwKSB7XG4gICAgICBlcnJvcnMucHVzaCgnQXJlYSBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAwJyk7XG4gICAgfVxuXG4gICAgaWYgKCFbJ3JvdW5kJywgJ3JlY3Rhbmd1bGFyJ10uaW5jbHVkZXMoZGF0YS5kdWN0VHlwZSkpIHtcbiAgICAgIGVycm9ycy5wdXNoKCdEdWN0IHR5cGUgbXVzdCBiZSBcInJvdW5kXCIgb3IgXCJyZWN0YW5ndWxhclwiJyk7XG4gICAgfVxuXG4gICAgaWYgKGRhdGEuZHVjdFR5cGUgPT09ICdyZWN0YW5ndWxhcicpIHtcbiAgICAgIGlmICghZGF0YS53aWR0aCB8fCBkYXRhLndpZHRoIDw9IDApIHtcbiAgICAgICAgZXJyb3JzLnB1c2goJ1dpZHRoIG11c3QgYmUgZ3JlYXRlciB0aGFuIDAgZm9yIHJlY3Rhbmd1bGFyIGR1Y3RzJyk7XG4gICAgICB9XG4gICAgICBpZiAoIWRhdGEuaGVpZ2h0IHx8IGRhdGEuaGVpZ2h0IDw9IDApIHtcbiAgICAgICAgZXJyb3JzLnB1c2goJ0hlaWdodCBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAwIGZvciByZWN0YW5ndWxhciBkdWN0cycpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChkYXRhLmR1Y3RUeXBlID09PSAncm91bmQnKSB7XG4gICAgICBpZiAoIWRhdGEuZGlhbWV0ZXIgfHwgZGF0YS5kaWFtZXRlciA8PSAwKSB7XG4gICAgICAgIGVycm9ycy5wdXNoKCdEaWFtZXRlciBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAwIGZvciByb3VuZCBkdWN0cycpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBpc1ZhbGlkOiBlcnJvcnMubGVuZ3RoID09PSAwLFxuICAgICAgZXJyb3JzXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBTTUFDTkFWYWxpZGF0b3I7XG4iXSwidmVyc2lvbiI6M30=